# -*- coding: utf-8; mode: _tcl; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- vim:fenc=utf-8:ft=tcl:et:sw=2:ts=2:sts=2

PortSystem          1.0
PortGroup github    1.0
PortGroup python    1.0

name                git-remote-hg
github.setup        mnauw git-remote-hg 1.0.3.2 v
revision            0
categories          devel python
platforms           darwin
maintainers         {landonf @landonf} openmaintainer
license             GPL-2
description         Transparent bidirectional bridge between Git and Mercurial for Git
long_description    {*}${description}.

checksums           rmd160  3c3c5dc2975cda2bf8e44752c2efd312f5b9342c \
sha256  4c2f91c3c1a83b3a4a6162b56e97872388f4b17fc9d2a6aedf2cd613256767f6 \
size    66640

python.default_version 310

depends_build       port:asciidoc \
                    port:py${python.version}-setuptools
depends_lib-append  port:mercurial

build.env-append    PYTHON=${python.bin}
destroot.env-append PYTHON=${python.bin}

post-patch {
    reinplace "1 s|/usr/bin/env python.*|${python.bin}|g" \
        ${worksrcpath}/git-remote-hg

    reinplace -E "s|^(prefix\[\[:space:\]\].*.?=).*|\\1 ${prefix}|g" \
        ${worksrcpath}/Makefile
}

post-build {
    system -W "${worksrcpath}" "make"
}

post-destroot {
    system -W "${worksrcpath}" \
        "make install-doc DESTDIR=${destroot} PREFIX=${prefix}"
}

test.run            yes
