# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           texlive 1.0

name                texlive-basic
version             62258
revision            0

categories          tex
maintainers         {dports @drkp}
license             Copyleft Permissive
description         TeX Live: Essential programs and files
long_description    These files are regarded as basic for any TeX system, covering plain TeX macros, Computer Modern fonts, and configuration for common drivers\; no LaTeX.

checksums           texlive-basic-62258-run.tar.xz \
                    rmd160  1444cdd4fa5e22b58176b194f3f01e32f8918853 \
                    sha256  3eef3848ea7b712f3b95571427cd60b0c46531f6dce7a37c1a2e4367c5ec5b96 \
                    texlive-basic-62258-doc.tar.xz \
                    rmd160  8b1cd069fe51061807a77422b3a47f63f0b70647 \
                    sha256  a98fd35ea4f37247bcabf66e5e6e635161763429026afb2c58fe4e4aa4e4c3cb \
                    texlive-basic-62258-src.tar.xz \
                    rmd160  39c1d6ad1d1844ae5b51248bd32b129ad428e0e6 \
                    sha256  6b2ac8772de593e7f4e3a0d60b90f9519d146cc605c5775f50590ca444d767f5

texlive.formats      \
    {1 luahbtex luahbtex language.def,language.dat.lua {luatex.ini}} \
    {1 dviluatex luatex language.def,language.dat.lua {dviluatex.ini}} \
    {1 luatex luatex language.def,language.dat.lua {luatex.ini}} \
    {1 mf mf-nowin - {-translate-file=cp227.tcx mf.ini}} \
    {1 etex pdftex language.def {-translate-file=cp227.tcx *etex.ini}} \
    {1 pdfetex pdftex language.def {-translate-file=cp227.tcx *pdfetex.ini}} \
    {1 pdftex pdftex language.def {-translate-file=cp227.tcx *pdfetex.ini}} \
    {1 tex tex - {tex.ini}}

texlive.maps      \
    {Map euler.map} \
    {MixedMap cm.map} \
    {MixedMap cmextra.map} \
    {MixedMap cyrillic.map} \
    {MixedMap latxfont.map} \
    {MixedMap symbols.map} \
    {MixedMap cmtext-bsr-interpolated.map} \
    {Map dummy-space.map}

texlive.binaries    afm2tfm bibtex dviluatex dvipdfm dvipdfmx dvipdft dvips ebb etex extractbb gftodvi gftopk gftype inimf initex kpseaccess kpsereadlink kpsestat kpsewhich luahbtex luatex makeindex mf mf-nowin mft mkindex pdfetex pdftex pktogf pktype simpdftex tex texlua texluac tlshell xdvi xdvipdfmx

texlive.exclude     texmf-dist/web2c/fmtutil.cnf \
                    texmf-dist/web2c/texmf.cnf \
                    texmf-dist/web2c/texmfcnf.lua \
                    texmf-dist/web2c/updmap.cfg \
                    texmf-dist/web2c/updmap.cfg \
                    texmf-dist/tex/generic/config/language.dat \
                    texmf-dist/tex/generic/config/language.dat.lua \
                    texmf-dist/tex/generic/config/language.def \
                    texmf-dist/fonts/map/dvipdfm/updmap \
                    texmf-dist/fonts/map/dvips/updmap \
                    texmf-dist/fonts/map/pdftex/updmap

patchfiles          patch-runfiles_texmf-dist_scripts_texlive_fmtutil.pl.diff
post-patch {
    reinplace "s|@@TEXMFDIST@@|${texlive_texmfdist}|" ${worksrcpath}/runfiles/texmf-dist/scripts/texlive/fmtutil.pl
    reinplace "s|@@PREFIX@@|${prefix}|" ${worksrcpath}/runfiles/texmf-dist/scripts/texlive/fmtutil.pl
    
    reinplace "s|rungs|gs|g" ${worksrcpath}/runfiles/texmf-dist/dvipdfmx/dvipdfmx.cfg
}

texlive.forceupdatecnf yes
texlive.use_mktexlsr_on_deactivate no

pre-activate {
    # Handle conflicts for TL2020 update
    if { ![catch {set vers [lindex [registry_active texlive-fonts-recommended] 0]}]
         && ([vercmp [lindex $vers 1] 54512] < 0) } {
        registry_deactivate_composite texlive-fonts-recommended "" [list ports_nodepcheck 1]
    }
    if { ![catch {set vers [lindex [registry_active texlive-plain-generic] 0]}]
         && ([vercmp [lindex $vers 1] 54476] < 0) } {
        registry_deactivate_composite texlive-plain-generic "" [list ports_nodepcheck 1]
    }
    if { ![catch {set vers [lindex [registry_active texlive-latex-extra] 0]}]
         && ([vercmp [lindex $vers 1] 54584] < 0) } {
        registry_deactivate_composite texlive-latex-extra "" [list ports_nodepcheck 1]
    }
    if { ![catch {set vers [lindex [registry_active texlive-bin-extra] 0]}]
         && ([vercmp [lindex $vers 1] 54608] < 0) } {
        registry_deactivate_composite texlive-bin-extra "" [list ports_nodepcheck 1]
    }

    # Handle conflicts for TL2019 upgrade
    if { ![catch {set vers [lindex [registry_active texlive-bin-extra] 0]}]
         && ([vercmp [lindex $vers 1] 50853] < 0) } {
        registry_deactivate_composite texlive-bin-extra "" [list ports_nodepcheck 1]
    }
    if { ![catch {set vers [lindex [registry_active texlive-xetex] 0]}]
         && ([vercmp [lindex $vers 1] 50852] < 0) } {
        registry_deactivate_composite texlive-xetex "" [list ports_nodepcheck 1]
    }
    if { ![catch {set vers [lindex [registry_active texlive-lang-cyrillic] 0]}]
         && ([vercmp [lindex $vers 1] 50792] < 0) } {
        registry_deactivate_composite texlive-lang-cyrillic "" [list ports_nodepcheck 1]
    }
    if { ![catch {set vers [lindex [registry_active texlive-lang-spanish] 0]}]
         && ([vercmp [lindex $vers 1] 50792] < 0) } {
        registry_deactivate_composite texlive-lang-spanish "" [list ports_nodepcheck 1]
    }
    if { ![catch {set vers [lindex [registry_active texlive-lang-european] 0]}]
         && ([vercmp [lindex $vers 1] 50792] < 0) } {
        registry_deactivate_composite texlive-lang-european "" [list ports_nodepcheck 1]
    }
    if { ![catch {set vers [lindex [registry_active texlive-lang-other] 0]}]
         && ([vercmp [lindex $vers 1] 50792] < 0) } {
        registry_deactivate_composite texlive-lang-other "" [list ports_nodepcheck 1]
    }
}


texlive.texmfport
