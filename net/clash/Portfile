# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           golang 1.0

go.setup            github.com/Dreamacro/clash 1.11.0 v
revision            0
categories          net
maintainers         {i0ntempest @i0ntempest} openmaintainer
license             GPL-3

description         A rule-based tunnel in Go
long_description    A rule-based tunnel in Go, feature-rich and supports VMess, Shadowsocks,\
                    Trojan, Snell protocols.

checksums           ${distname}${extract.suffix} \
                        rmd160  c88623a71a29e65d4df9297d6a8e97b73013dc40 \
                        sha256  f941bda8b0d4a0c4c1f23f96f47e4456019b7f9d53b2f72009caf9973ba33b44 \
                        size    188889

go.vendors          gopkg.in/yaml.v3 \
                        lock    v3.0.1 \
                        rmd160  e85ac1368fb7f9ef945b7fd7bd608a1f0d261c12 \
                        sha256  f3ea6be3f405ec25f8799773355aba54f8831d11f5315a01155bdc69b92eca7b \
                        size    91208 \
                    gopkg.in/check.v1 \
                        lock    788fd7840127 \
                        rmd160  b63165c8909a27edc15dda210df66a1b49efb49e \
                        sha256  7e5547c6471cc48da89a7c87f965b20ca5311f43fc4d883ca62f9fccf7551630 \
                        size    31597 \
                    golang.org/x/xerrors \
                        lock    5ec99f83aff1 \
                        rmd160  6e8267f353e153297f205e4be219236d6ae43880 \
                        sha256  9a500a49d83a09e7de6c71b215d1c14b81e315d26884530ef327c95ddf1f2d28 \
                        size    13667 \
                    golang.org/x/tools \
                        lock    07bc1bf47fb2 \
                        rmd160  2eab0a00a460712e54fcd46b23e5ccfb291e39ae \
                        sha256  8db63675d757450ae2470f4785f5d53739b13dc2488e88b75faaf2d3d58b91b5 \
                        size    2852185 \
                    golang.org/x/text \
                        lock    v0.3.7 \
                        rmd160  52777fe8a68660aab6e4588322a5949b0ba42e58 \
                        sha256  48971ba6a3123c4fd81b2bdec9fda3cef5815fad76f2407c8a888032462c542d \
                        size    8356115 \
                    golang.org/x/sys \
                        lock    4f61da869c0c \
                        rmd160  dde05d05b0a1a052e9bd7c916f656c44f4c2a773 \
                        sha256  eb7adab079e92811933e9af9f317d0d27f1105055cae18dc2537e64ca4d796a6 \
                        size    1305580 \
                    golang.org/x/sync \
                        lock    0de741cfad7f \
                        rmd160  d773a4a5c1e17d3cf5313fb70b57f58c8d4dbb48 \
                        sha256  07b3c295f680ebbfde6f9e116c94dc950bbd32fe00ccbfaee963fb9893decc2c \
                        size    19529 \
                    golang.org/x/net \
                        lock    355a448f1bc9 \
                        rmd160  c1c51d2d9e6dddda78b37f28eec15ae9fbc083f6 \
                        sha256  6820753e144eb775733966b1a76115b725af219c2a471cab3de1f9cf962a33a6 \
                        size    1228591 \
                    golang.org/x/mod \
                        lock    v0.4.2 \
                        rmd160  0f3ca57198b4de4eb89b2c1a2bdb01af040d1f36 \
                        sha256  e2e4cba5719f804f2ec901b4ccdf6d3abf05521868ed54f271be7c1bf6c48549 \
                        size    104573 \
                    golang.org/x/crypto \
                        lock    793ad666bf5e \
                        rmd160  188c801055ed34a0a6f74b1021535cd0f0b01486 \
                        sha256  27c6b9caa232c99325ca0463324651ee8cb1f15ae43bd1366399c0e0e2a1f735 \
                        size    1631363 \
                    go.uber.org/automaxprocs \
                        repo    github.com/uber-go/automaxprocs \
                        lock    v1.5.1 \
                        rmd160  ca650072987207ce5fef3e0b3464a8e6dbbd6fbc \
                        sha256  504552108553abddc533d4fcf77c6159fd3f694f18af95d16c791ebf3c06dc96 \
                        size    22413 \
                    go.uber.org/atomic \
                        repo    github.com/uber-go/atomic \
                        lock    v1.9.0 \
                        rmd160  7705959c7053aa8e405560f5ffef3fbca414ee69 \
                        sha256  8baccde94a6ecaea185ef40b9bdecbd3dd8d8df7cbc50c89856b58c5cd897e40 \
                        size    21353 \
                    go.etcd.io/bbolt \
                        repo    github.com/etcd-io/bbolt \
                        lock    v1.3.6 \
                        rmd160  934af729b47e620f5cd9dc35df49aa25ee1d4132 \
                        sha256  9a4df17332a1e279b44a288d33dfbdb151ecf5be825ce5075fa97d7d7e930ec6 \
                        size    98074 \
                    github.com/u-root/uio \
                        lock    82958018845c \
                        rmd160  931a747e3e5105cdef2a0da1b5526fe746d97813 \
                        sha256  58499181b80e5efde61bacf1f351106aa447f11d8dc99eda2d2c2e3bdbbe0d66 \
                        size    12581 \
                    github.com/stretchr/testify \
                        lock    v1.7.2 \
                        rmd160  7b66e7deaf770a7a259240cb8c852e2fd0fe98cf \
                        sha256  6f46e814d48b1308d1b2226e10057aca1541975504cda8926bf432614952c8cd \
                        size    94068 \
                    github.com/sirupsen/logrus \
                        lock    v1.8.1 \
                        rmd160  aeb4e5f2ea8112e787a72fba611605c4c87f42b5 \
                        sha256  931c31f624d05136760b41a63f6bc146b79ac91776b4642cbd2026c2792e3aca \
                        size    47184 \
                    github.com/prashantv/gostub \
                        lock    v1.1.0 \
                        rmd160  2a180f3086bf793f4f574165c926290196ed6140 \
                        sha256  eabe92e081c6ae53b105506caf512bed68f5170e74705ee22aac4cce814f281d \
                        size    7908 \
                    github.com/pmezard/go-difflib \
                        lock    v1.0.0 \
                        rmd160  fc879bfbdef9e3ff50844def58404e2b5a613ab8 \
                        sha256  7cd492737641847266115f3060489a67f63581e521a8ec51efbc280c33fc991f \
                        size    11409 \
                    github.com/oschwald/maxminddb-golang \
                        lock    v1.9.0 \
                        rmd160  1f8b1f3c0e44d002a297b01569deb8cb8c5fbdd9 \
                        sha256  9c3b61ed12f0359845a4003ebeb149c97ec940b5d7c5fd48a866c4ebda7bf149 \
                        size    25355 \
                    github.com/oschwald/geoip2-golang \
                        lock    v1.7.0 \
                        rmd160  97dfbfe66ee1e1d1238da79e3b229957bab712b4 \
                        sha256  12e664f121b277909ded3015bf416f9630635ae4c504ad1158b8cc3a8b5de478 \
                        size    9200 \
                    github.com/miekg/dns \
                        lock    v1.1.49 \
                        rmd160  69ff3a03975d953ac9771376972cf1b2b942cbd0 \
                        sha256  7c77f40b9bcf54e7003b81fdb4e86a56e50f31b720836a779ea709c7ffccb420 \
                        size    208703 \
                    github.com/kr/text \
                        lock    v0.2.0 \
                        rmd160  48558c7e8ff67d510f83c66883907e95f4783163 \
                        sha256  2f2e21ac8a9d523e88cbba4039441defc4a66bfaa78811c900a88fcf28729c4c \
                        size    8702 \
                    github.com/kr/pretty \
                        lock    v0.1.0 \
                        rmd160  9aa7a5aad4c48840eecfd0f80186d1fb5ded0fd6 \
                        sha256  f6c3f89667c63e5b7f1fc6ee2c06b6a6bfdce88f3a965ccd395b64c6f95c9a47 \
                        size    8553 \
                    github.com/insomniacslk/dhcp \
                        lock    1ca156eafb9f \
                        rmd160  1ab0e07d0a49addd6d0530dc88b98e8f1bd1643f \
                        sha256  5b543deb9a05e90d681f5057f92cf77e7963084e7fac38a6413257f8d482b625 \
                        size    146923 \
                    github.com/gorilla/websocket \
                        lock    v1.5.0 \
                        rmd160  ff5a4278af87e04d06521f4cf1db6fd48c0403b2 \
                        sha256  e26e73242d694a6a43458bec8d7e32f6a3d355539484eeb04c5b0c182dc79d9f \
                        size    54163 \
                    github.com/gofrs/uuid \
                        lock    v4.2.0 \
                        rmd160  b801c2564604eae0489e1ffb80468df1eb4b088e \
                        sha256  6344b69d1f6686389a5c981037150264a350cec6310cbdc419c8ff7a5b05b7b3 \
                        size    22388 \
                    github.com/go-chi/render \
                        lock    v1.0.1 \
                        rmd160  2d5279f316d812c26e523f44e5e95cddd07bb49c \
                        sha256  1175fe1e48ca63d7ef5d0ad4f4cfe58a4c9a436440890db8c8da5df5359245af \
                        size    5575 \
                    github.com/go-chi/cors \
                        lock    v1.2.1 \
                        rmd160  77d9d00288f070cab2e42f542d1882ccf23103f5 \
                        sha256  6a7191078f7c316b94947ae61f7164c58ff533f6be1b0817f61158dd841d609d \
                        size    8830 \
                    github.com/go-chi/chi \
                        lock    v5.0.7 \
                        rmd160  a8219e991e520563152ea30e72eb8b6fb7841351 \
                        sha256  1e620c74e7ceeeb40a9941b8c75cfddd7e06544ae7df292e801624348a00a9fb \
                        size    82810 \
                    github.com/davecgh/go-spew \
                        lock    v1.1.1 \
                        rmd160  7c02883aa81f81aca14e13a27fdca9e7fbc136f7 \
                        sha256  e85d6afa83e64962e0d63dd4812971eccf2b9b5445eda93f46a4406f0c177d5f \
                        size    42171

set time [clock format [clock seconds] -format "%a %b %e %H:%M:%S %Z %Y"]
build.args-append   -ldflags=\"-X 'github.com/Dreamacro/clash/constant.Version=v${version}' -X 'github.com/Dreamacro/clash/constant.BuildTime=${time}'\"

destroot {
    xinstall -m 0755 ${worksrcpath}/${name} ${destroot}${prefix}/bin/
    file mkdir ${destroot}${prefix}/etc/clash
    copy ${filespath}/options.yaml ${destroot}${prefix}/etc/clash/options.yaml
    copy ${filespath}/config.yaml ${destroot}${prefix}/etc/clash/config.yaml.example
}

post-activate {
    if {![file exists ${prefix}/etc/clash/config.yaml]} {
        copy ${prefix}/etc/clash/config.yaml.example ${prefix}/etc/clash/config.yaml
    }
}

notes-append "
    The default config file is copied to ${prefix}/etc/clash/config.yaml and its content\
    will be preserved across upgrades and reinstalls. The startup item will use this config\
    file by default. A manual containing all configuration options can be found at\
    ${prefix}/etc/clash/options.yaml.
"

startupitem.create          yes
startupitem.executable      ${prefix}/bin/clash -d ${prefix}/etc/clash
