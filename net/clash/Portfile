# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           golang 1.0

go.setup            github.com/Dreamacro/clash 1.10.0 v
revision            1
categories          net
maintainers         {i0ntempest @i0ntempest} openmaintainer
license             GPL-3

description         A rule-based tunnel in Go
long_description    A rule-based tunnel in Go, feature-rich and supports VMess, Shadowsocks,\
                    Trojan, Snell protocols.

checksums           ${distname}${extract.suffix} \
                        rmd160  936f94e383358b0cf5b4655e96d29f2e5523cf55 \
                        sha256  18b6c61285e403d8cf032ab4174ed9d48f0102e1b573708630cd8c9c2c93e956 \
                        size    227438

go.vendors          gopkg.in/yaml.v3 \
                        lock    9f266ea9e77c \
                        rmd160  06dca2ede07b2f31c515b4711fbebc1d5359b5e4 \
                        sha256  e70dd42fb30b7b2d0129c5cdf0e079caaf5602cab24081fdac830ec01204fa59 \
                        size    86890 \
                    gopkg.in/yaml.v2 \
                        lock    v2.4.0 \
                        rmd160  66e9feb7944b3804efa63155ed9b618717b8955c \
                        sha256  72812077e7f20278003de6ab0d85053d89131d64c443f39115a022114fd032b6 \
                        size    73231 \
                    gopkg.in/check.v1 \
                        lock    788fd7840127 \
                        rmd160  b63165c8909a27edc15dda210df66a1b49efb49e \
                        sha256  7e5547c6471cc48da89a7c87f965b20ca5311f43fc4d883ca62f9fccf7551630 \
                        size    31597 \
                    golang.org/x/xerrors \
                        lock    5ec99f83aff1 \
                        rmd160  6e8267f353e153297f205e4be219236d6ae43880 \
                        sha256  9a500a49d83a09e7de6c71b215d1c14b81e315d26884530ef327c95ddf1f2d28 \
                        size    13667 \
                    golang.org/x/tools \
                        lock    07bc1bf47fb2 \
                        rmd160  2eab0a00a460712e54fcd46b23e5ccfb291e39ae \
                        sha256  8db63675d757450ae2470f4785f5d53739b13dc2488e88b75faaf2d3d58b91b5 \
                        size    2852185 \
                    golang.org/x/text \
                        lock    v0.3.7 \
                        rmd160  52777fe8a68660aab6e4588322a5949b0ba42e58 \
                        sha256  48971ba6a3123c4fd81b2bdec9fda3cef5815fad76f2407c8a888032462c542d \
                        size    8356115 \
                    golang.org/x/sys \
                        lock    039c03cc5b86 \
                        rmd160  a05ada6866e573999d3aa9b0849ba403df4a4a7b \
                        sha256  48e5f65f066743ee5ab1e2c896970c15d0164834952865c3fb0c19ec46cda429 \
                        size    1288667 \
                    golang.org/x/sync \
                        lock    036812b2e83c \
                        rmd160  f42be6eb3565d2ed3d1066ea1a7f69437c8bb1e6 \
                        sha256  6f1daceb16cd75bdbf35da6c50aa352d1995d68ccd0049851d27686f451fad92 \
                        size    18756 \
                    golang.org/x/net \
                        lock    27dd8689420f \
                        rmd160  d7b9477ec487c7f547c2d6669088f0b77c4ecd3f \
                        sha256  53a566616d208e83a2ec4a58651a450187a3bef980128571a04b01f6231e162d \
                        size    1229543 \
                    golang.org/x/mod \
                        lock    v0.4.2 \
                        rmd160  0f3ca57198b4de4eb89b2c1a2bdb01af040d1f36 \
                        sha256  e2e4cba5719f804f2ec901b4ccdf6d3abf05521868ed54f271be7c1bf6c48549 \
                        size    104573 \
                    golang.org/x/crypto \
                        lock    3147a52a75dd \
                        rmd160  0be571ad1c43b15a8233efee5efa4a17a8ec9a31 \
                        sha256  d8dac234fd1d0d6dbeb9b37e16be5d496665bada3b557e8dffb84d5528aaed39 \
                        size    1630553 \
                    go.uber.org/automaxprocs \
                        repo    github.com/uber-go/automaxprocs \
                        lock    v1.4.0 \
                        rmd160  52804d713060b31d329cf60c45e6429dbc2e553b \
                        sha256  725c62bbddf53165709b75c1a4ba7055e3424f21a129b90ce4632d3ea94910fb \
                        size    19646 \
                    go.uber.org/atomic \
                        repo    github.com/uber-go/atomic \
                        lock    v1.9.0 \
                        rmd160  7705959c7053aa8e405560f5ffef3fbca414ee69 \
                        sha256  8baccde94a6ecaea185ef40b9bdecbd3dd8d8df7cbc50c89856b58c5cd897e40 \
                        size    21353 \
                    go.etcd.io/bbolt \
                        repo    github.com/etcd-io/bbolt \
                        lock    v1.3.6 \
                        rmd160  934af729b47e620f5cd9dc35df49aa25ee1d4132 \
                        sha256  9a4df17332a1e279b44a288d33dfbdb151ecf5be825ce5075fa97d7d7e930ec6 \
                        size    98074 \
                    github.com/u-root/uio \
                        lock    82958018845c \
                        rmd160  931a747e3e5105cdef2a0da1b5526fe746d97813 \
                        sha256  58499181b80e5efde61bacf1f351106aa447f11d8dc99eda2d2c2e3bdbbe0d66 \
                        size    12581 \
                    github.com/stretchr/testify \
                        lock    v1.7.1 \
                        rmd160  9e07f7d6890b8598706260ece5db26a7b12b5b2a \
                        sha256  27cabaf81344157a188083266cf8ccc19d04c43d9a34b6276b760514b9c880a3 \
                        size    94020 \
                    github.com/sirupsen/logrus \
                        lock    v1.8.1 \
                        rmd160  aeb4e5f2ea8112e787a72fba611605c4c87f42b5 \
                        sha256  931c31f624d05136760b41a63f6bc146b79ac91776b4642cbd2026c2792e3aca \
                        size    47184 \
                    github.com/pmezard/go-difflib \
                        lock    v1.0.0 \
                        rmd160  fc879bfbdef9e3ff50844def58404e2b5a613ab8 \
                        sha256  7cd492737641847266115f3060489a67f63581e521a8ec51efbc280c33fc991f \
                        size    11409 \
                    github.com/oschwald/maxminddb-golang \
                        lock    v1.8.0 \
                        rmd160  df12137865d3ed774cfa8a2280fadb1cc3f70666 \
                        sha256  a97543b5273e1ac29ce20cd691d8e7df4e38d320cc3a161ed4773db582fefff5 \
                        size    25015 \
                    github.com/oschwald/geoip2-golang \
                        lock    v1.6.1 \
                        rmd160  e630aa6a480cd75db9a385b2f7906e7071229caf \
                        sha256  c72d85e07b77e86af30a7af8bf12c414059a682c0004ad0271f4c4d9c8da2499 \
                        size    9723 \
                    github.com/miekg/dns \
                        lock    v1.1.47 \
                        rmd160  be97b348b4148e8d1d7815c2a09fc555fe61e55e \
                        sha256  daea2463571652bc74bbc23f4912de02f9cf4b2c2a0a07deee8304b4e8d5c51b \
                        size    204618 \
                    github.com/kr/text \
                        lock    v0.1.0 \
                        rmd160  0b3c78459e227170a3b80a0103d87a3eef77ed88 \
                        sha256  5ed970aad0da3cba3cffacdb4d154a162a8968655ee6d6f7b627e71b869efaf6 \
                        size    8691 \
                    github.com/kr/pretty \
                        lock    v0.1.0 \
                        rmd160  9aa7a5aad4c48840eecfd0f80186d1fb5ded0fd6 \
                        sha256  f6c3f89667c63e5b7f1fc6ee2c06b6a6bfdce88f3a965ccd395b64c6f95c9a47 \
                        size    8553 \
                    github.com/insomniacslk/dhcp \
                        lock    3c283ff8b7dd \
                        rmd160  5a09fa9488c0910bb4b3d6d974e389f00a6ef653 \
                        sha256  bd486b8ebf218c6c97a631c699285ea2a9d116833384a1e37c1981bade703b1e \
                        size    146493 \
                    github.com/gorilla/websocket \
                        lock    v1.5.0 \
                        rmd160  ff5a4278af87e04d06521f4cf1db6fd48c0403b2 \
                        sha256  e26e73242d694a6a43458bec8d7e32f6a3d355539484eeb04c5b0c182dc79d9f \
                        size    54163 \
                    github.com/gofrs/uuid \
                        lock    v4.2.0 \
                        rmd160  b801c2564604eae0489e1ffb80468df1eb4b088e \
                        sha256  6344b69d1f6686389a5c981037150264a350cec6310cbdc419c8ff7a5b05b7b3 \
                        size    22388 \
                    github.com/go-chi/render \
                        lock    v1.0.1 \
                        rmd160  2d5279f316d812c26e523f44e5e95cddd07bb49c \
                        sha256  1175fe1e48ca63d7ef5d0ad4f4cfe58a4c9a436440890db8c8da5df5359245af \
                        size    5575 \
                    github.com/go-chi/cors \
                        lock    v1.2.0 \
                        rmd160  610aa7d114f0fab3f13ecd09f4cd287dcdb76d5e \
                        sha256  810db6809718b07ae22703b8e0a7a6359e3ab8cc829529be32a4be04e9da7802 \
                        size    8409 \
                    github.com/go-chi/chi \
                        lock    v5.0.7 \
                        rmd160  a8219e991e520563152ea30e72eb8b6fb7841351 \
                        sha256  1e620c74e7ceeeb40a9941b8c75cfddd7e06544ae7df292e801624348a00a9fb \
                        size    82810 \
                    github.com/davecgh/go-spew \
                        lock    v1.1.1 \
                        rmd160  7c02883aa81f81aca14e13a27fdca9e7fbc136f7 \
                        sha256  e85d6afa83e64962e0d63dd4812971eccf2b9b5445eda93f46a4406f0c177d5f \
                        size    42171 \
                    github.com/Dreamacro/go-shadowsocks2 \
                        lock    v0.1.7 \
                        rmd160  be908bbf4cce25f6c3dae4528ea794ae1f37edbe \
                        sha256  065cd199d25ec856f6bc7c21a49f46a900386ecc03464b6494907e1f53551468 \
                        size    20014

set time [clock format [clock seconds] -format "%a %b %e %H:%M:%S %Z %Y"]
build.args-append   -ldflags=\"-X 'github.com/Dreamacro/clash/constant.Version=v${version}' -X 'github.com/Dreamacro/clash/constant.BuildTime=${time}'\"

destroot {
    xinstall -m 0755 ${worksrcpath}/${name} ${destroot}${prefix}/bin/
    file mkdir ${destroot}${prefix}/etc/clash
    copy ${filespath}/options.yaml ${destroot}${prefix}/etc/clash/options.yaml
    copy ${filespath}/config.yaml ${destroot}${prefix}/etc/clash/config.yaml.example
}

post-activate {
    if {![file exists ${prefix}/etc/clash/config.yaml]} {
        copy ${prefix}/etc/clash/config.yaml.example ${prefix}/etc/clash/config.yaml
    }
}

notes-append "
    The default config file is copied to ${prefix}/etc/clash/config.yaml and its content\
    will be preserved across upgrades and reinstalls. The startup item will use this config\
    file by default. A manual containing all configuration options can be found at\
    ${prefix}/etc/clash/options.yaml.
"

startupitem.create          yes
startupitem.executable      ${prefix}/bin/clash -d ${prefix}/etc/clash
