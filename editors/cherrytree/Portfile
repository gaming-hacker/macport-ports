# -*- coding: utf-8; mode: _tcl; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- vim:fenc=utf-8::et:sw=2:ts=2:sts=2

PortSystem              1.0
PortGroup               github 1.0
PortGroup               cmake  1.1
PortGroup               app    1.0
PortGroup               active_variants 1.1

github.setup            giuspen cherrytree 0.99.39
revision                0
categories              editors
license                 GPL-3+
maintainers             nomaintainer

checksums               rmd160  db35f372e7f5b119c20c51291a84ca154bbd6cf4 \
sha256  37ab93e25569dfdc472262cc19cfee69b0c26043780c5e3ff9b44ff322818a4f \
size    17993346

description             Hierarchical Note Taking
long_description        A Hierarchical Note Taking Application, featuring Rich Text\
                        and Syntax Highlighting

platforms               darwin

compiler.cxx_standard   2017

patchfiles              patch-cherrytree-all-apple-is-not-homebrew-for-goodness-sake.diff

depends_build-append    port:pkgconfig

depends_build-append    port:python39
configure.args-append   -DPYTHON_EXEC=${prefix}/bin/python3.9

depends_lib-append      port:adwaita-icon-theme \
                        port:atk \
                        port:atkmm \
                        port:cairo \
                        port:cairomm \
                        port:curl \
                        port:enchant2 \
                        port:gdk-pixbuf2 \
                        port:gettext \
                        path:lib/pkgconfig/glib-2.0.pc:glib2 \
                        port:glibmm \
                        port:gspell \
                        port:gtk3 \
                        port:gtkmm3 \
                        port:gtksourceview3 \
                        port:gtksourceviewmm3 \
                        port:libfmt \
                        port:libsigcxx2 \
                        port:libxmlxx2 \
                        port:libxml2 \
                        port:pango \
                        port:pangomm \
                        port:sqlite3 \
                        port:spdlog \
                        port:uchardet

configure.args-append   -DBUILD_TESTING=OFF

if {${os.platform} eq "darwin" && ${os.major} < 18} {
    # the legacysupport implementation of this did not work for me, doing it manually
    depends_lib-append  port:macports-libcxx
    configure.cxxflags-append -nostdinc++ -I${prefix}/include/libcxx/v1
    configure.ldflags-append  -L${prefix}/lib/libcxx

   notes-append    "This build of ${name} will use an external libc++ as your system\
                    libc++ is not new enough to support ${name}. Issues may arise."
}

if {${os.platform} eq "darwin" && ${os.major} < 13} {
    # uses '-k' option to gzip which is not supported until 10.9
    depends_build-append  port:gzip
}

app.name                CherryTree
app.executable          ${prefix}/bin/${name}
app.icon                ./icons/cherrytree.ico
app.use_launch_script   yes

variant x11 conflicts quartz {
   require_active_variants gtk3 x11 quartz

   notes-append    "This is ${name} +x11. You will need an X11 server installed, either\
                    xorg-server from MacPorts or XQuartz, to view this application. If you\
                    prefer a macOS-native quartz version, please install ${name} +quartz instead."
}

variant quartz conflicts x11 {
   require_active_variants gtk3 quartz x11
}

if {![variant_isset quartz]} {
    default_variants-append +x11
}
